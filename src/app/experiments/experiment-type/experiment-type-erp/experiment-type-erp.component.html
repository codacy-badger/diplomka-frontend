<div class="row">
  <div class="col">
    <form [formGroup]="form">

      <!-- Generická hlavička společná pro všechny experimenty -->
      <app-experiment-type-header [form]="form"></app-experiment-type-header>

      <div class="row experiment-property">
        <div class="col-10">
          <h4>ERP parametry</h4>
        </div>
        <div class="col-2 text-right" appContentToggler [toggledContent]="erpParams" [icon]="icon"><i class="fas fa-minus" #icon></i></div>

        <div class="col-12" #erpParams>
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="sequence-source-experiment">Dostupné sekvence</label>
                <div class="form-row">
                  <div class="col-12 col-lg-4">
                    <select id="sequence-source-experiment" class="selectpicker form-control form-control-sm" formControlName="sequenceId">
                      <option *ngFor="let sequence of (sequences$ | async)" [value]="sequence.id">{{sequence.name}}</option>
                    </select>
                  </div>
                  <div class="col-12 col-lg-8 float-md-right">
                    <a class="btn btn-primary btn-sm" [routerLink]="['/', 'sequences', experiment.sequenceId]" [class.disabled]="!sequenceId.value"><i class="fas fa-edit"></i> Editovat</a>
                    <button class="btn btn-danger btn-sm ml-2" (click)="handleRemoveSequence()" [disabled]="!sequenceId.value"><i class="fas fa-minus"></i> Odebrat</button>
                    <app-dropdown-btn small="true" text="Nová" class="ml-2" buttonAsLink="true"
                                      [disabled]="isNew"
                                      [icon]="'fa-plus'"
                                      [navigationLink]="['/', 'sequences', 'new']"
                                      [queryParams]="{sourceExperimentId: experiment.id}">
                      <a class="dropdown-item" [routerLink]="['/', 'sequences', 'new']" [queryParams]="{sourceExperimentId: experiment.id}"><i class="fas fa-hands-helping"></i> S průvodcem</a>
                      <button class="dropdown-item" (click)="handleCreateNewSequenceFast()"><i class="fas fa-bolt"></i> Rychle</button>
                    </app-dropdown-btn>
                    <a class="btn btn-secondary btn-sm ml-2" [routerLink]="['/', 'sequences']"><i class="fas fa-eye"></i> Prohlížet</a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">

            <div class="col-12">
              <div class="form-group" style="padding-bottom: 5px">
                <label for="erp-output-count">output count</label>
                <ng5-slider id="erp-output-count" formControlName="outputCount" [options]="outputCountParams"></ng5-slider>
              </div>
            </div>
            <div class="col-12 col-sm-4 col-md-3">
              <div class="form-group">
                <label for="erp-out">out</label>
                <div class="input-group input-group-sm">
                  <input type="number" id="erp-out" class="form-control" [class.is-valid]="out.valid" [class.is-invalid]="out.invalid" formControlName="out">
                  <div class="input-group-append">
                    <span class="input-group-text">ms</span>
                  </div>
                </div>
                <small *ngIf="out.touched && out.errors?.required" class="form-text text-muted">Parametr out je vyžadován.</small>
                <small *ngIf="out.touched && out.errors?.min" class="form-text text-muted">Minimální hodnota je: {{out.errors?.min.min}}.</small>
                <small *ngIf="out.touched && out.errors?.max" class="form-text text-muted">Maximální hodnota je: {{out.errors?.max.max}}.</small>
              </div>
            </div>
            <div class="col-12 col-sm-4 col-md-2">
              <div class="form-group">
                <label for="erp-wait">wait</label>
                <div class="input-group input-group-sm">
                  <input type="number" id="erp-wait" class="form-control" [class.is-valid]="wait.valid" [class.is-invalid]="wait.invalid" formControlName="wait">
                  <div class="input-group-append">
                    <span class="input-group-text">ms</span>
                  </div>
                </div>
                <small *ngIf="wait.touched && wait.errors?.required" class="form-text text-muted">Parametr wait je vyžadován.</small>
                <small *ngIf="wait.touched && wait.errors?.min" class="form-text text-muted">Minimální hodnota je: {{wait.errors?.min.min}}.</small>
                <small *ngIf="wait.touched && wait.errors?.max" class="form-text text-muted">Maximální hodnota je: {{wait.errors?.max.max}}.</small>
              </div>
            </div>

            <div class="col-12 col-sm-4 col-md-3">
              <div class="form-group">
                <label for="erp-max-dstribution">max distribution</label>
                <div class="input-group input-group-sm">
                  <input type="number" id="erp-max-dstribution" class="form-control" [class.is-valid]="maxDistribution.valid" [class.is-invalid]="maxDistribution.invalid" formControlName="maxDistribution">
                  <div class="input-group-append">
                    <span class="input-group-text">ms</span>
                  </div>
                </div>
                <small *ngIf="maxDistribution.touched && maxDistribution.errors?.required" class="form-text text-muted">Parametr max distribution je vyžadován.</small>
                <small *ngIf="maxDistribution.touched && maxDistribution.errors?.min" class="form-text text-muted">Minimální hodnota je: {{maxDistribution.errors?.min.min}}.</small>
              </div>
            </div>

            <div class="col-12 col-sm-6 col-md-2">
              <div class="form-group">
                <label for="erp-random">random</label>
                <select name="erp-random" id="erp-random" class="selectpicker form-control form-control-sm" formControlName="random">
                  <option *ngFor="let random of randoms" [value]="random.id">{{random.name}}</option>
                </select>
              </div>
            </div>
            <div class="col-12 col-sm-6 col-md-2">
              <div class="form-group">
                <label for="erp-edge">edge</label>
                <select name="erp-edge" id="erp-edge" class="selectpicker form-control form-control-sm" formControlName="edge">
                  <option *ngFor="let edge of edges" [value]="edge.id">{{edge.name}}</option>
                </select>
              </div>
            </div>

          </div>
        </div>
      </div>

      <app-experiment-type-erp-output [form]="form" [count]="outputCount.value" [experimentId]="experiment.id" *ngIf="!isNew"
                                      [experimentLoaded]="experimentLoaded$"></app-experiment-type-erp-output>

    </form>
  </div>
</div>

<app-fab [icon]="(working | async) ? 'fa-save fa-spin' : 'fa-save'" (fabClick)="handleSaveExperiment()" [disabled]="form.invalid || (working | async)"></app-fab>

<app-modal #modal></app-modal>
